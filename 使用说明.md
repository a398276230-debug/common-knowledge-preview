# RimTalk Expanded Preview 使用说明

## 快速开始

### 1. 安装
1. 确保已安装前置mod：RimTalk-ExpandMemory
2. 将本mod放在mod列表中RimTalk-ExpandMemory之后
3. 重启游戏

### 2. 基本设置
进入游戏 → 选项 → Mod设置 → RimTalk Expanded Preview

推荐设置：
- ✅ Use New Tag Matching (启用新匹配逻辑)
- ✅ Enable Knowledge Chaining (启用常识链)
- Max Chaining Rounds: 2 (常识链轮数)

### 3. 理解新的匹配逻辑

#### 核心概念：简单直接
本mod**不会**对你的输入进行复杂处理，而是：
1. 直接使用你的原始输入文本
2. 加上当前角色的信息（名字、性别、种族、特质、技能）
3. 检查这个合并后的文本是否**包含**常识的标签
4. 如果包含，就触发该常识

#### 示例
```
你的输入："告诉我关于龙王种的信息"
当前角色：索拉克（龙王种，男性，射击12级）

系统会检查："告诉我关于龙王种的信息 索拉克 男性 龙王种 射击"

常识库：
[龙王种] 龙王种的介绍  ← 触发！（包含"龙王种"）
[索拉克] 索拉克的介绍  ← 触发！（包含"索拉克"）
[射击] 射击技能说明    ← 触发！（包含"射击"）
[人类] 人类的介绍      ← 不触发
```

### 4. 使用常识库

#### 打开常识管理界面
游戏中按快捷键或通过菜单打开常识库管理界面

#### 理解两个新按钮
每条常识右侧有两个小按钮：

**第一个按钮（提取）**：
- ✓ 绿色 = 允许提取内容用于常识链
- × 红色 = 不提取内容

**第二个按钮（匹配）**：
- ✓ 绿色 = 允许被关键词匹配
- × 红色 = 禁止匹配

#### 推荐配置

**规则类常识**（如"回复控制在80字以内"）：
- 提取：× 红色（避免"规则"、"回复"等词触发其他常识）
- 匹配：✓ 绿色（允许被匹配）

**世界观常识**（如"龙王种的介绍"）：
- 提取：✓ 绿色（允许触发相关常识）
- 匹配：✓ 绿色（允许被匹配）

**角色专属常识**：
- 提取：✓ 绿色
- 匹配：✓ 绿色

## 常见问题

### Q1: 为什么我的常识没有被触发？
A: 检查以下几点：
1. 常识的"匹配"按钮是否为绿色✓
2. 常识是否启用（左侧复选框）
3. **标签是否被包含在输入文本中**（新逻辑的关键！）
4. 如果是第二轮匹配，检查上一轮常识的"提取"按钮是否为绿色✓

**重要**：新逻辑是**包含匹配**，不是模糊匹配！
- ✅ 标签"龙王种"会匹配"关于龙王种的信息"
- ✅ 标签"索拉克"会匹配"索拉克是谁"
- ❌ 标签"龙王"不会匹配"龙王种"（不完全包含）

### Q2: 常识链是如何工作的？
A: 
```
第1轮：
输入："龙王种"
匹配到：[龙王种] 龙王种包括索拉克和梅菲斯特

第2轮（如果启用常识链）：
从第1轮常识内容提取："龙王种包括索拉克和梅菲斯特"
用这个文本继续匹配：
  - 匹配到：[索拉克] 索拉克的介绍（包含"索拉克"）
  - 匹配到：[梅菲斯特] 梅菲斯特的介绍（包含"梅菲斯特"）

最终返回：3条常识
```

### Q3: 如何避免规则类常识污染常识链？
A: 将规则类常识的"提取"按钮设为× 红色

### Q4: 新匹配逻辑和旧逻辑有什么区别？
A:
- **旧逻辑**：
  - 对输入进行n元语法分词（如"龙王种"→"龙王"、"王种"、"龙王种"）
  - 计算TF-IDF权重
  - 分析内容相关性
  - 复杂但不准确

- **新逻辑**：
  - 直接用原始文本
  - 简单的包含检查（IndexOf）
  - 快速且精确
  - 用户完全可控

### Q5: 如何设置标签才能更好地匹配？
A: 
**好的标签**：
- ✅ [龙王种] - 完整的词
- ✅ [索拉克] - 角色名
- ✅ [射击] - 技能名
- ✅ [规则] - 明确的分类

**不好的标签**：
- ❌ [龙] - 太短，容易误触发
- ❌ [王] - 太短，容易误触发
- ❌ [龙王种介绍] - 太长，不容易被包含

### Q6: Pawn信息是如何自动添加的？
A: 系统会自动提取当前角色的：
- 名字（如"索拉克"）
- 性别（如"男性"）
- 种族（如"龙王种"）
- 特质（最多5个）
- 高等级技能（10级以上）

这些信息会自动添加到匹配文本中，所以即使你没有明确提到，相关常识也可能被触发。

## 高级技巧

### 技巧1：分层常识结构
```
第1层（总览）：
[龙王种] 龙王种包括索拉克和梅菲斯特
- 提取：✓  匹配：✓

第2层（详细）：
[索拉克] 索拉克的详细介绍...
[梅菲斯特] 梅菲斯特的详细介绍...
- 提取：×  匹配：✓
```

这样当用户问"龙王种"时：
- 第1轮：触发总览常识
- 第2轮：从总览内容中触发详细常识

### 技巧2：控制常识链深度
- 1轮：只匹配用户输入（最精确）
- 2轮：用户输入 + 第1轮常识触发的常识（推荐）
- 3轮+：更深层次的关联（可能产生噪音）

### 技巧3：使用多标签
```
[龙王种,索拉克,外星种族] 索拉克是龙王种的一个分支
```
这样可以被"龙王种"、"索拉克"或"外星种族"任一关键词触发

### 技巧4：利用Pawn信息自动匹配
如果你有一个角色叫"索拉克"，创建常识：
```
[索拉克] 索拉克的个人信息
```

当这个角色说话时，即使用户没有提到"索拉克"，这条常识也会自动触发（因为角色名会被自动添加到匹配文本中）。

### 技巧5：避免标签冲突
如果你有：
```
[龙] 龙的介绍
[龙王种] 龙王种的介绍
```

当输入包含"龙王种"时，两条都会触发！

解决方案：
- 删除太短的标签
- 或者将短标签的"匹配"设为×

## 故障排除

### 问题：mod无法加载
解决：
1. 检查是否安装了前置mod RimTalk-ExpandMemory
2. 检查mod加载顺序（本mod应在前置mod之后）
3. 查看游戏日志中的错误信息

### 问题：按钮不显示
解决：
1. 确保mod已启用
2. 重启游戏
3. 检查是否与其他UI mod冲突

### 问题：常识链不工作
解决：
1. 检查mod设置中"Enable Knowledge Chaining"是否启用
2. 检查常识的"提取"按钮是否为绿色✓
3. 检查"Max Chaining Rounds"是否大于1

### 问题：常识触发太多/太少
解决：
- **太多**：检查标签是否太短或太常见
- **太少**：检查标签是否完全包含在输入文本中

### 问题：想临时禁用新逻辑
解决：
在Mod设置中取消"Use New Tag Matching"，系统会回退到前置mod的原始匹配逻辑。

## 实战示例

### 场景1：角色介绍
```
常识设置：
[索拉克] 索拉克是龙王种，擅长近战
- 提取：✓  匹配：✓

当索拉克说话时：
用户："介绍一下自己"
匹配文本："介绍一下自己 索拉克 男性 龙王种 近战"
结果：触发常识（包含"索拉克"）
```

### 场景2：技能查询
```
常识设置：
[射击] 射击是远程战斗技能
- 提取：✓  匹配：✓

当射击12级的角色说话时：
用户："我的技能怎么样"
匹配文本："我的技能怎么样 索拉克 男性 龙王种 射击"
结果：触发常识（包含"射击"）
```

### 场景3：世界观查询
```
常识设置：
[龙王种] 龙王种包括索拉克和梅菲斯特
[索拉克] 索拉克擅长近战
[梅菲斯特] 梅菲斯特擅长魔法

用户："告诉我关于龙王种的信息"
第1轮：触发[龙王种]
第2轮：从"龙王种包括索拉克和梅菲斯特"中
       触发[索拉克]和[梅菲斯特]
结果：返回3条常识
```

## 更新与反馈

如有问题或建议，请访问GitHub仓库提交Issue。
